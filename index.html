<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë∂üèª Ranker ü•á</title>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --secondary-hover: #5a6268;
            --success-color: #28a745;
            --success-hover: #218838;
            --text-color: #333;
            --border-color: #ddd;
            --list-bg: #fff;
            --list-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --delete-btn-bg: #e0e0e0;
            --delete-btn-hover: #d3d3d3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 2em;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 90%;
        }

        .main-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1em;
        }

        .main-header h1 {
            flex-grow: 1;
            text-align: center;
            margin: 0;
        }

        /* --- Pane Header with Button --- */
        .pane-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5em;
            margin-top: 1.5em;
        }

        h2 {
            margin: 0;
            border-bottom: none;
        }
        
        /* Make titles editable and add placeholder */
        h2[contenteditable]:empty:before {
            content: attr(data-placeholder);
            color: #ccc;
        }
        h2[contenteditable]:focus {
            outline: none;
        }


        /* --- Buttons --- */
        button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: white;
            background-color: var(--secondary-color);
        }

        button:hover:not(:disabled) {
            background-color: var(--secondary-hover);
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* --- Input and Controls --- */
        .add-item-container {
            display: flex;
            gap: 10px;
            margin-top: 1em;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
        }

        /* --- Lists --- */
        .panes-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2em;
            margin-top: 1em;
            width: 100%;
        }

        @media (max-width: 1024px) {
            .panes-container {
                grid-template-columns: 1fr;
            }
        }
        
        .list-wrapper {
            background-color: var(--list-bg);
            border-radius: 8px;
            padding: 1em;
            box-shadow: var(--list-shadow);
        }

        .instructions-pane {
            background-color: transparent;
            box-shadow: none;
        }

        ol {
            list-style-type: none;
            padding-left: 0;
            min-height: 20px;
        }

        li {
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 20px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }

        .instructions-pane li {
            background-color: transparent;
            border: none;
            box-shadow: none;
            display: list-item;
            padding: 0;
        }
        
        .list-item-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rank-number {
            font-weight: bold;
            color: var(--primary-color);
            min-width: 25px;
            text-align: right;
        }
        
        .delete-btn {
            background-color: var(--delete-btn-bg);
            color: #757575;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
            padding: 0;
        }
        
        .delete-btn:hover {
            background-color: var(--delete-btn-hover);
        }
        
        .delete-btn svg {
            width: 12px;
            height: 12px;
            stroke: currentColor;
            stroke-width: 2;
        }

        li .rank-info {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 0.9em;
        }

        /* --- Drag and Drop --- */
        .draggable-list li {
            cursor: grab;
        }
        
        .draggable-list li.add-input {
            cursor: default;
        }
        
        .draggable-list li:active {
            cursor: grabbing;
        }
        
        .dragging {
            opacity: 0.5;
            background: #cce5ff;
        }
        
        .drag-over {
            border-top: 2px solid var(--primary-color);
        }

        /* --- Modal Styles --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2em;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            max-width: 500px;
            width: 80%;
        }
        
        /* Modal header for correct layout and single border */
        .modal-header {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 0.5em;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1em;
        }

        .modal-header h2 {
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }

        .modal-close-btn {
            color: #aaa;
            position: absolute;
            top: 0;
            right: 0;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        
        .hidden {
            display: none;
        }
        
    </style>
</head>
<body>

    <div class="container">
        <div class="main-header">
            <h1>üë∂üèª Baby Name Ranker ü•á</h1>
            <button id="editNamesButton">Edit Names</button>
        </div>
        
        <div class="panes-container">
            <!-- Mum's Ranking Pane -->
            <div class="list-wrapper" id="mum-pane">
                <div class="pane-header">
                    <h2 contenteditable="true" data-placeholder="Mum's Ranking">Mum's Ranking</h2>
                    <button id="hideShowMumButton">Hide Ranking</button>
                </div>
                <ol id="mumList" class="draggable-list"></ol>
            </div>
            
            <!-- Dad's Ranking Pane -->
            <div class="list-wrapper" id="dad-pane">
                <div class="pane-header">
                    <h2 contenteditable="true" data-placeholder="Dad's Ranking">Dad's Ranking</h2>
                    <button id="hideShowDadButton">Hide Ranking</button>
                </div>
                <ol id="dadList" class="draggable-list"></ol>
            </div>

            <!-- Final Ranking Pane -->
            <div class="list-wrapper">
                <div class="pane-header">
                    <h2>Final Ranking</h2>
                    <button id="hideShowFinalButton">Hide Ranking</button>
                </div>
                <ol id="finalListDisplay"></ol>
            </div>
        </div>

    </div>

    <!-- Instructions Modal -->
    <div id="editNamesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Names</h2>
                <span class="modal-close-btn">&times;</span>
            </div>
             <div class="add-item-container">
                <input type="text" id="modalItemInput" placeholder="Add new name...">
                <button id="addModalItemButton" style="background-color: var(--success-color);">Add</button>
            </div>
            <ol id="modalList"></ol>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE ---
            let masterList = [];
            let mumOrder = [];
            let dadOrder = [];
            let dragStartIndex;

            // --- DOM ELEMENTS ---
            const editNamesButton = document.getElementById('editNamesButton');
            const editNamesModal = document.getElementById('editNamesModal');
            const modalCloseBtn = document.querySelector('.modal-close-btn');

            const mumList = document.getElementById('mumList');
            const dadList = document.getElementById('dadList');
            const finalListDisplay = document.getElementById('finalListDisplay');

            const modalItemInput = document.getElementById('modalItemInput');
            const addModalItemButton = document.getElementById('addModalItemButton');
            const modalList = document.getElementById('modalList');
            
            const hideShowMumButton = document.getElementById('hideShowMumButton');
            const hideShowDadButton = document.getElementById('hideShowDadButton');
            const hideShowFinalButton = document.getElementById('hideShowFinalButton');

            const mumPane = document.getElementById('mum-pane');
            const dadPane = document.getElementById('dad-pane');
            
            // --- CONSTANTS ---
            const medalEmojis = ["ü•á", "ü•à", "ü•â"];
            const closeIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/></svg>';

            // --- RENDER FUNCTIONS ---
            function renderList(list, element, allowDelete = false) {
                element.innerHTML = '';
                list.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.setAttribute('data-index', index);
                    li.draggable = element.id !== 'modalList';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'list-item-content';

                    // Add rank number only for the main lists
                    if (!allowDelete) {
                        contentDiv.innerHTML = `<span class="rank-number">${index + 1}.</span><span>${item}</span>`;
                    } else {
                        contentDiv.innerHTML = `<span>${item}</span>`;
                    }
                    
                    li.appendChild(contentDiv);
                    
                    if (allowDelete) {
                        const deleteButton = document.createElement('button');
                        deleteButton.innerHTML = closeIconSVG;
                        deleteButton.className = 'delete-btn';
                        deleteButton.addEventListener('click', () => deleteItem(index));
                        li.appendChild(deleteButton);
                    }
                    
                    element.appendChild(li);
                });
                updateDragListeners(element);
            }

            function renderFinalList(rankedItems) {
                finalListDisplay.innerHTML = '';
                let currentMedalIndex = 0;
                let previousAvgRank = null;

                rankedItems.forEach((item, index) => {
                    const li = document.createElement('li');
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'list-item-content';

                    if (index > 0 && item.avgRank > previousAvgRank) {
                        currentMedalIndex++;
                    }
                    
                    let rankNumberHTML = `<span class="rank-number">${index + 1}.</span>`;
                    if (currentMedalIndex < medalEmojis.length) {
                        rankNumberHTML = `<span class="rank-number">${medalEmojis[currentMedalIndex]}</span>`;
                    }
                    
                    contentDiv.innerHTML = `${rankNumberHTML}<span>${item.text}</span>`;
                    
                    const rankSpan = document.createElement('span');
                    rankSpan.textContent = `avg(${item.rankA}, ${item.rankB}) = ${item.avgRank.toFixed(2)}`;
                    rankSpan.className = 'rank-info';
                    
                    li.appendChild(contentDiv);
                    li.appendChild(rankSpan);
                    finalListDisplay.appendChild(li);
                    
                    previousAvgRank = item.avgRank;
                });
            }

            // --- CORE LOGIC ---
            function addName() {
                const text = modalItemInput.value.trim();
                if (text && !masterList.includes(text)) {
                    masterList.push(text);
                    synchronizeLists();
                    modalItemInput.value = '';
                    compareAndRank();
                    modalItemInput.focus();
                }
            }
            
            function deleteItem(index) {
                masterList.splice(index, 1);
                synchronizeLists();
                compareAndRank();
            }

            function synchronizeLists() {
                // Keep the existing order as much as possible, just add/remove items
                const newMumOrder = masterList.filter(name => mumOrder.includes(name));
                const newDadOrder = masterList.filter(name => dadOrder.includes(name));

                masterList.forEach(name => {
                    if (!newMumOrder.includes(name)) newMumOrder.push(name);
                    if (!newDadOrder.includes(name)) newDadOrder.push(name);
                });

                mumOrder = newMumOrder;
                dadOrder = newDadOrder;
                
                renderList(mumOrder, mumList);
                renderList(dadOrder, dadList);
                renderList(masterList, modalList, true);
            }

            function compareAndRank() {
                if (mumOrder.length === 0 || dadOrder.length === 0) {
                    finalListDisplay.innerHTML = '';
                    return;
                }

                const rankedItems = mumOrder.map((item, indexA) => {
                    const indexB = dadOrder.indexOf(item);
                    if (indexB === -1) {
                         const rankA = indexA + 1;
                         const rankB = mumOrder.length + 1;
                         const avgRank = (rankA + rankB) / 2;
                         return { text: item, avgRank, rankA, rankB };
                    }
                    
                    const rankA = indexA + 1;
                    const rankB = indexB + 1;
                    const avgRank = (rankA + rankB) / 2;
                    return { text: item, avgRank, rankA, rankB };
                });
                
                rankedItems.sort((a, b) => a.avgRank - b.avgRank);
                renderFinalList(rankedItems);
            }
            
            function toggleVisibility(listElement, buttonElement) {
                const isHidden = listElement.classList.toggle('hidden');
                buttonElement.textContent = isHidden ? 'Show Ranking' : 'Hide Ranking';
            }

            // --- DRAG & DROP LOGIC ---
            function dragStart(e) {
                dragStartIndex = +this.getAttribute('data-index');
                e.target.classList.add('dragging');
            }

            function dragEnter(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            }

            function dragLeave() {
                this.classList.remove('drag-over');
            }

            function dragOver(e) {
                e.preventDefault();
            }
            
            function dragDrop(e) {
                e.preventDefault();
                const dragEndIndex = +this.getAttribute('data-index');
                const parentElement = this.parentElement;
                this.classList.remove('drag-over');
                
                let listToUpdate;
                if (parentElement.id === 'mumList') {
                    listToUpdate = mumOrder;
                } else if (parentElement.id === 'dadList') {
                    listToUpdate = dadOrder;
                } else {
                    return;
                }

                const itemToMove = listToUpdate.splice(dragStartIndex, 1)[0];
                listToUpdate.splice(dragEndIndex, 0, itemToMove);
                
                if (parentElement.id === 'mumList') {
                    renderList(mumOrder, mumList);
                } else {
                    renderList(dadOrder, dadList);
                }
                
                compareAndRank();
            }

            function dragEnd() {
                this.classList.remove('dragging');
            }
            
            function updateDragListeners(element) {
                const draggables = element.querySelectorAll('li');
                draggables.forEach(draggable => {
                    draggable.addEventListener('dragstart', dragStart);
                    draggable.addEventListener('dragenter', dragEnter);
                    draggable.addEventListener('dragleave', dragLeave);
                    draggable.addEventListener('dragover', dragOver);
                    draggable.addEventListener('drop', dragDrop);
                    draggable.addEventListener('dragend', dragEnd);
                });
            }

            // --- INITIALIZATION ---
            addModalItemButton.addEventListener('click', addName);
            modalItemInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addName();
            });
            hideShowMumButton.addEventListener('click', () => toggleVisibility(mumList, hideShowMumButton));
            hideShowDadButton.addEventListener('click', () => toggleVisibility(dadList, hideShowDadButton));
            hideShowFinalButton.addEventListener('click', () => toggleVisibility(finalListDisplay, hideShowFinalButton));

            // Modal event listeners
            editNamesButton.addEventListener('click', () => {
                editNamesModal.style.display = 'flex';
                // Rerender the modal list to ensure it's up to date
                renderList(masterList, modalList, true);
            });
            modalCloseBtn.addEventListener('click', () => {
                editNamesModal.style.display = 'none';
            });
            window.addEventListener('click', (event) => {
                if (event.target === editNamesModal) {
                    editNamesModal.style.display = 'none';
                }
            });

            // Initial render
            synchronizeLists();
            compareAndRank();
        });
    </script>
</body>
</html>
